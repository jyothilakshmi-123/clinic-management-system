<div class="section">
    <div class="container">
        <div class="row">
            <div class="col-md-6 m-auto ">
                <h2 class="text-center mt-3">Add Patient</h2>
                <form class="mb-5 mt-3" action="/admin/add-patient" method="POST" enctype="multipart/form-data">

                    <label for="name">Name</label>
                    <input type="text" class="form-control" name="ptName">



                    <label for="age">Age</label>
                    <input type="number" class="form-control" name="ptAge">


                    <label for="mobile">Mobile Number</label>
                    <input type="text" class="form-control" name="ptMobile">

                   <div class="form-group">
                        {{!-- <label for="">Image</label> --}}
                        {{!-- <input type="file" name="Image" id="upphoto" class="form-control-file"> --}}
                        <input type="file" id="upphoto" style="display:none; "  name="Image">
                        <label for="upphoto">
                            <div class="inputLabel">
                                click here to upload an image
                            </div>
                        </label>
                    </div>
                    <div>
                        <img id="croppedImg" style=" margin:auto;">
                    </div>
                    <button type="submit" class="btn btn-success mt-3">Submit</button>
                    <input type="hidden" id="Status" name="Status" value="Active">
                </form>
            </div>
            <div class="col-md-12">
                <div class="cropHolder">
                    <div id="cropWrapper">
                        <img id="inputImage" src="/images/face.jpg">
                    </div>
                    <div class="cropInputs">
                        <div class="inputtools">
                            <p>
                                <span>
                                    <img src="/images/horizontal.png">
                                </span>
                                <span>horizontal movement</span>
                            </p>
                            <input type="range" class="cropRange" name="xmove" id="xmove" min="0" value="0">
                        </div>
                        <div class="inputtools">
                            <p>
                                <span>
                                    <img src="/images/vertical.png">
                                </span>
                                <span>vertical movement</span>
                            </p>
                            <input type="range" class="cropRange" name="ymove" id="ymove" min="0" value="0">
                        </div>
                        <br>
                        <button class="cropButtons" id="zplus">
                            <img src="/images/add.png">
                        </button>
                        <button class="cropButtons" id="zminus">
                            <img src="/images/minus.png">
                        </button>
                        <br>
                        <button id="cropSubmit">submit</button>
                        <button id="closeCrop">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>

(function ($) {
    $.fn.finecrop = function (options) {

        var defaults = {
            viewHeight: 0,
            cropWidth: 200,
            cropHeight: 200,
            cropInput: 'myImage',
            cropOutput: 'mysource',
            zoomValue: 10
        };
        var settings = $.extend({}, defaults, options);
        return this.each(function () {
            var $obj = $(this);
            $($obj).change(function () {
                if (this.files && this.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#' + settings.cropInput).attr('src', e.target.result).css('opacity', 0);
                        $('#' + settings.cropInput).attr('height', settings.viewHeight + 'px')
                        $(".cropHolder").show();
                        setTimeout(function () {
                            cropstart();
                        }, 1000);

                    };
                    reader.readAsDataURL(this.files[0]);
                }
            });

            function cropstart() {
                /* Let's Create canvas and backgrounds
                 * First : background canvas, it will behind all
                 * Second : transparent background
                 * Third: 2nd canvas, where image will get cropped 
                 */
                var cropContainer = $("#cropWrapper");
                var bgcanvas = document.createElement('canvas');
                bgcanvas.id = 'bgCanvas';
                bgcanvas.style.border = '1px solid #000';
                $(cropContainer).append(bgcanvas);

                // black sheet div
                var blacksheet = document.createElement('div');
                blacksheet.id = 'blacksheet';
                $(cropContainer).append(blacksheet);

                // cropped canvas
                var getCropped = document.createElement('canvas');
                getCropped.id = 'getCropped';
                getCropped.width = settings.cropWidth;
                getCropped.height = settings.cropHeight;
                getCropped.style.border = '1px solid #000';
                $(cropContainer).append(getCropped);



                /* CONSTANT
                 * These two variable are constant as the actual width or height of an image is constant
                 * 1. imgSrc : source of Image
                 * 2. actualWidth : Natural width of image
                 * 3. actualHeight : Natural height of image
                 */
                var imgSrc = document.getElementById(settings.cropInput); //$("#myImage");
                var actualWidth = imgSrc.naturalWidth;
                var actualHeight = imgSrc.naturalHeight;
                var zoomValue = 0; // initial

                // imgSrc.setAttribute('height', 500 + 'px'); // initial

                var moveHorizontal = document.getElementById('xmove');
                var moveVertical = document.getElementById('ymove');
                var zoomIn = document.getElementById("zplus");
                var zoomOut = document.getElementById("zminus");



                var elemWidth, elemHeight, lValue, tValue;

                function getImgRef() {
                    elemWidth = imgSrc.width;
                    elemHeight = imgSrc.height;
                    lValue = (elemWidth - settings.cropWidth) / 2;
                    tValue = (elemHeight - settings.cropHeight) / 2;
                    // --- dynamic max values ---
                    moveHorizontal.setAttribute('max', (elemWidth - settings.cropWidth));
                    moveVertical.setAttribute('max', (elemHeight - settings.cropHeight));

                    moveHorizontal.setAttribute('value', (elemWidth - settings.cropWidth) / 2);
                    moveVertical.setAttribute('value', (elemHeight - settings.cropHeight) / 2);

                }
                getImgRef();


                document.getElementById("zplus").onclick = function () {
                    var imgSrcHeight = parseInt(imgSrc.getAttribute('height'));
                    imgSrc.setAttribute('height', (imgSrcHeight + settings.zoomValue) + 'px');
                    getImgRef();
                    bgCanvas(lValue, tValue);
                }
                document.getElementById("zminus").onclick = function () {
                    var imgSrcHeight = parseInt(imgSrc.getAttribute('height'));
                    imgSrc.setAttribute('height', (imgSrcHeight - settings.zoomValue) + 'px');
                    getImgRef();
                    bgCanvas(lValue, tValue);
                }
                document.getElementById('cropSubmit').onclick = function () {
                    $("#" + settings.cropOutput).attr('src', getCropped.toDataURL());
                    $(bgcanvas).remove();
                    $(blacksheet).remove();
                    $(getCropped).remove();
                    $(".cropHolder").hide();
                }
                document.getElementById("closeCrop").onclick = function(){
                    $(bgcanvas).remove();
                    $(blacksheet).remove();
                    $(getCropped).remove();
                    $(".cropHolder").hide();
                }
                // ------------- -------- drawImage properties ---------- -----------------
                function cropCanvas(x, y) {

                    var imgSrcC = bgcanvas;
                    var context = getCropped.getContext("2d");

                    var cwidth = getCropped.width;
                    var cheight = getCropped.height;
                    
                    var sx = (elemWidth - cwidth) / 2;
                    var sy = (elemHeight - cheight) / 2;
                    var swidth = cwidth;
                    var sheight = cheight;

                    var dwidth = cwidth;
                    var dheight = cheight;

                    context.clearRect(0, 0, cwidth, cheight);
                    context.drawImage(imgSrcC, sx, sy, swidth, sheight, 0, 0, dwidth, dheight);
                    // img, sx, sy, swidth, sheight, dx, dy, dwidth, dheight
                    // s = source
                    // d = destination
                };


                // --------------- bg canvas -------------------
                function bgCanvas(x, y) {
                    lValue = x;
                    tValue = y;

                    var context = bgcanvas.getContext("2d");

                    var cwidth = elemWidth;
                    var cheight = elemHeight;
                    bgcanvas.width = cwidth;
                    bgcanvas.height = cheight;
                    context.clearRect(0, 0, cwidth, cheight);
                    /*
                     * To ensure the perspective of an image, here is the calculation for new width and height
                     * nw/nh = w/h;
                     * nh = (h*nw)/w;
                     + these below 'minus' lines are not in use anymore 
                     - var dwidth = cwidth + zoomValue;
                     - var dheight = (cheight * (cwidth + zoomValue))/cwidth;
                     */


                    var dwidth = cwidth;
                    var dheight = cheight;

                    var sx = (((x - (elemWidth - settings.cropWidth) / 2) * actualWidth) / elemWidth) + zoomValue;
                    var sy = (((y - (elemHeight - settings.cropHeight) / 2) * actualHeight) / elemHeight);
                    var swidth = (cwidth * actualWidth) / elemWidth;
                    var sheight = (cheight * actualHeight) / elemHeight;
                    
                    context.drawImage(imgSrc, sx, sy, swidth, sheight, 0, 0, dwidth, dheight);
                    cropCanvas(x, y);
                };

                bgCanvas(lValue, tValue);
                /* get the current input
                   for IE, 'oninput' doesn't work, should use 'onchange' 
                */
                if (navigator.appName == 'Microsoft Internet Explorer' || !!(navigator.userAgent.match(/Trident/) || navigator.userAgent.match(/rv:11/)) || (typeof $.browser !== "undefined" && $.browser.msie == 1)) {
                    alert("please do not use IE :) ");
                } else {
                    moveHorizontal.oninput = function (event) {
                        bgCanvas(event.target.value, tValue)
                    }
                    moveVertical.oninput = function (event) {
                        bgCanvas(lValue, event.target.value);
                    }
                }
            }
        });
    };
}(jQuery));
    $("#upphoto").finecrop({
  viewHeight: 500,
  cropWidth: 200,
  cropHeight: 200,
  cropInput: 'inputImage',
  cropOutput: 'croppedImg',
  zoomValue: 50
});
</script>