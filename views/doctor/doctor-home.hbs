<header>

    <nav class="navbar navbar-expand-lg navbar-light bg-white ">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01"
            aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
            {{!-- <a class="navbar-brand  font-weight-bold text-white bg-success" data-toggle="tab" href="#">Doctor</a>
            --}}
            <div class="container-fluid">
                <ul class="nav nav-tabs nav-justified  ">
                    <li class="nav-item mr-1  active ">

                        <a href="doctor/doctor-home" class="nav-link bg-info text-white tablinks "
                            onclick="doctor(event,'Appointments')" id="defaultOpen" data-toggle="tab">Appointments</a>
                    </li>
                    <li class="nav-item mr-1 active ">
                        <a href="doctor/doctor-home" class="nav-link bg-info text-white tablinks"
                            onclick="doctor(event,'Bookings')" data-toggle="tab">Bookings</a>
                    </li>
                    <li class="nav-item mr-1 active ">
                        <a href="doctor/doctor-home" class="nav-link bg-info text-white tablinks"
                            onclick="doctor(event,'MyPatients')" data-toggle="tab">My Patients</a>
                    </li>
                    <li class="nav-item mr-1 active">
                        <a href="doctor/doctor-home" class="nav-link bg-info text-white tablinks"
                            onclick="doctor(event,'Results')" data-toggle="tab">Results</a>
                    </li>
                </ul>
            </div>
            {{!-- <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#">Disabled</a>
                </li>
            </ul> --}}
            <div class="dropdown ml-auto  ">
                <button class="btn btn-secondary dropdown-toggle mr-5 " type="button" id="dropdownMenuButton"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">

                    {{#if doctor}}
                    {{doctor.drName}}

                    {{/if}}

                </button>
                <div class="dropdown-menu " aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" href="#">My Profile</a>
                    {{#if doctor}}
                    <a class="dropdown-item" href="/doctor/logout">Logout</a>
                    {{else}}
                    <a class="dropdown-item " href="/doctor">Login</a>
                    {{/if}}



                </div>
            </div>
        </div>
    </nav>

</header>
<section>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="modal fade" id="consult-form">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close mr-auto" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>

                            </div>
                            <div class="modal-body  ">
                                <h3 class="text-center">Consulting Patient...</h3>
                                {{#each todaysConfirmedAppointments }}
                                <form action="/doctor/consulted" method="POST">
                                    <div class="container border p-5">
                                        <div class="row ">
                                            <div class="col">
                                                <input type="text" class="form-control" name="userName"
                                                    value="{{this.userName}}">
                                            </div>
                                            <div class="col">
                                                <input type="number" class="form-control" name="userAge"
                                                    value="{{this.userAge}}">
                                            </div>

                                        </div>
                                        <div class="row mt-5">
                                            <div class="col">

                                                <label for="comment">Prescription</label>
                                                <textarea rows="5" name="userPrescription" id="comment"
                                                    class="form-control" placeholder="Prescription"></textarea>


                                            </div>

                                        </div>
                                        <input type="hidden" id="drId" name="drId" value="{{this.dr_id}}">
                                        <input type="hidden" id="userId" name="userId" value="{{this.user_id}}">
                                        <input type="hidden" id="appointmentId" name="appointmentId"
                                            value="{{this._id}}">
                                        <input type="hidden" id="dateOfBooking" name="dateOfBooking"
                                            value="{{this.dateOfBooking}}">

                                        <div class="row mt-4 ">
                                            <button class="ml-auto p-2 text-white" onclick="divide()"
                                                style="border-radius: 10px; background-color: rgb(13, 13, 104);"
                                                type="submit" name="submit" value="submit"
                                                class="btn ">Consulted</button>
                                        </div>
                                    </div>
                                </form>
                                {{/each}}


                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</section>
<section>
    <div class="row">
        <div class="col-md-2  ml-5 mb-5 " style="padding-right: 0px; background-color: lightblue; height: 350px;">
            <div class=" row">
                <div class="personalDetails  ">
                    <ul><img style="width: 130px;
                    height: 140px;
                    border-radius: 50%;" class=" mb-3 mt-5  " src="/doctor-images/{{doctor._id}}.jpg" alt=""></ul>
                    {{!-- <ul class="pt-5 "><i class="fas fa-user fa-3x"></i></ul> --}}
                    <ul class=" pl-5 ">
                        <h4>{{doctor.drName}}</h4>
                    </ul>
                    <ul class="text-dark">{{doctor.drEmail}}</ul>
                </div>
                <div class="text-center">
                    <a class="ml-5" href="/doctor/edit-doctor/{{doctor._id}}">
                        Edit Profile </a>
                </div>

                {{!-- <div class="row" style="padding-right: 0px; height: 200px; background-color: teal;">

                </div> --}}
            </div>


        </div>
        <div class="col-md-9 bg-light border p-4 ml-3 mb-5 " style=" ">

            <div class="tabcontent" id="Appointments">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a href="#Today" class=" nav-link active  mr-4" role="tab" data-toggle="tab">Today</a>
                    </li>
                    <li class="nav-item">
                        <a href="#Upcoming" class="nav-link    mr-4" role="tab" data-toggle="tab">Upcoming</a>
                    </li>
                    <li class="nav-item">
                        <a href="#Consulted" class="nav-link   " role="tab" data-toggle="tab">Consulted</a>
                    </li>
                    <li class="nav-item">
                        <a href="#Cancelled" class="nav-link   " role="tab" data-toggle="tab">Cancelled</a>
                    </li>
                    <li class="nav-item">
                        <a href="#Expired" class="nav-link   " role="tab" data-toggle="tab">Expired</a>
                    </li>
                    <form class="form-inline p-3 ml-auto">
                        <input type="text" name="search1" id="search1" class="form-control" />

                    </form>
                </ul>


                <div class="tab-content">
                    <div class="tab-pane active container" role="tabpanel" id="Today">
                        <div class="col-md-12">
                            <table class="table mt-4  border p-3 mb-5">
                                <thead>
                                    <tr>
                                        <th scope="col">Patient Name</th>
                                        <th scope="col">Appointment Date</th>
                                        <th scope="col">Mobile Number</th>

                                        {{!-- <th scope="col">Price</th> --}}
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{#each todaysConfirmedAppointments }}
                                    <tr>
                                        {{!-- <th scope="row">3</th> --}}

                                        <td><img class="mr-2" style="width: 50px; height: 50px "
                                                src="/user-images/{{this.user_id}}.jpg" alt="">{{this.userName}}</td>
                                        <td>{{this.dateOfBooking}}</td>
                                        <td>{{this.userMobile}}</td>

                                        <td><a href="" style="color: green;" data-toggle="modal"
                                                data-target="#consult-form">Consult</a></td>


                                        {{!-- <td><a href="/doctor/consult-form"
                                                style="color: rgb(79, 228, 79);">Consult</a>
                                        </td>
                                        <td> --}}


                                    </tr>
                                    {{/each}}
                                </tbody>
                            </table>
                        </div>


                    </div>
                    <div class="tab-pane " role="tabpanel" id="Upcoming">
                        <table class="table mt-4  border p-3 mb-5">
                            <thead>
                                <tr>
                                    <th scope="col">Patient Name</th>
                                    <th scope="col">Appointment Date</th>
                                    <th scope="col">Mobile Number</th>

                                    {{!-- <th scope="col">Price</th> --}}
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each upcomingConfirmedAppointments }}
                                <tr>
                                    {{!-- <th scope="row">3</th> --}}

                                    <td><img class="mr-2" style="width: 50px; height: 50px "
                                            src="/user-images/{{this.user_id}}.jpg" alt="">{{this.userName}}</td>
                                    <td>{{this.dateOfBooking}}</td>
                                    <td>{{this.userMobile}}</td>

                                    <td><a href="" style="color: green;" data-toggle="modal"
                                            data-target="#consult-form">Consult</a></td>


                                    {{!-- <td><a href="/doctor/consult-form"
                                            style="color: rgb(79, 228, 79);">Consult</a>
                                    </td>
                                    <td> --}}


                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </div>
                    <div class="tab-pane " role="tabpanel" id="Consulted">
                        <table class="table mt-4  border p-3 mb-5">
                            <thead>
                                <tr>
                                    <th scope="col">Patient Name</th>
                                    <th scope="col">Appointment Date</th>
                                    <th scope="col">Mobile Number</th>

                                    {{!-- <th scope="col">Price</th> --}}
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each consultedAppointments }}
                                <tr>
                                    {{!-- <th scope="row">3</th> --}}

                                    <td><img class="mr-2" style="width: 50px; height: 50px "
                                            src="/user-images/{{this.user_id}}.jpg" alt="">{{this.userName}}</td>
                                    <td>{{this.dateOfBooking}}</td>
                                    <td>{{this.userMobile}}</td>


                                    {{!-- <td><a href="" style="color: green;">{{this.Status}}</a></td> --}}
                                    <td>
                                        <p style="color: green;">{{this.Status}}</p>
                                    </td>



                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </div>

                    <div class="tab-pane  container" role="tabpanel" id="Cancelled">
                        <div class="col-md-12">
                            <table class="table mt-4  border p-3 mb-5">
                                <thead>
                                    <tr>
                                        <th scope="col">Patient Name</th>
                                        <th scope="col">Appointment Date</th>
                                        <th scope="col">Mobile Number</th>

                                        {{!-- <th scope="col">Price</th> --}}
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{#each cancelledAppointments }}
                                    <tr>
                                        {{!-- <th scope="row">3</th> --}}

                                        <td><img class="mr-2" style="width: 50px; height: 50px "
                                                src="/user-images/{{this.user_id}}.jpg" alt="">{{this.userName}}</td>
                                        <td>{{this.dateOfBooking}}</td>
                                        <td>{{this.userMobile}}</td>


                                        <td>
                                            <p style="color: green;">Cancelled</p>
                                        </td>


                                        {{!-- <td><a href="/doctor/consult-form"
                                                style="color: rgb(79, 228, 79);">Consult</a>
                                        </td>
                                        <td> --}}


                                    </tr>
                                    {{/each}}
                                </tbody>
                            </table>
                        </div>


                    </div>
                    <div class="tab-pane  container" role="tabpanel" id="Expired">
                        <div class="col-md-12">
                            <table class="table mt-4  border p-3 mb-5">
                                <thead>
                                    <tr>
                                        <th scope="col">Patient Name</th>
                                        <th scope="col">Appointment Date</th>
                                        <th scope="col">Mobile Number</th>

                                        {{!-- <th scope="col">Price</th> --}}
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{#each expiredAppointments }}
                                    <tr>
                                        {{!-- <th scope="row">3</th> --}}

                                        <td><img class="mr-2" style="width: 50px; height: 50px "
                                                src="/user-images/{{this.user_id}}.jpg" alt="">{{this.userName}}</td>
                                        <td>{{this.dateOfBooking}}</td>
                                        <td>{{this.userMobile}}</td>

                                        <td><a href="" style="color: green;">{{this.Status}}</a></td>


                                        {{!-- <td><a href="/doctor/consult-form"
                                                style="color: rgb(79, 228, 79);">Consult</a>
                                        </td>
                                        <td> --}}


                                    </tr>
                                    {{/each}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>



            </div>






            <div class="tabcontent" id="Bookings">
                <form class="form-inline p-3 ml-auto">
                    <input type="text" name="search2" id="search2" class="form-control ml-auto" />

                </form>
                <table class="table mt-4  border p-3 mb-5">
                    <thead>
                        <tr>
                            <th scope="col">Patient Name</th>
                            <th scope="col">Appointment Date</th>
                            <th scope="col">Mobile Number</th>

                            {{!-- <th scope="col">Price</th> --}}
                            <th scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each pendingAppointments }}
                        <tr>
                            {{!-- <th scope="row">3</th> --}}

                            <td><img class="mr-2" style="width: 50px; height: 50px "
                                    src="/user-images/{{this.user_id}}.jpg" alt="">{{this.userName}}</td>
                            <td>{{this.dateOfBooking}}</td>
                            <td>{{this.userMobile}}</td>

                            <td><a href="" style="color: green;" class="mr-3"
                                    onclick="appointmentConfirm('{{this._id}}')">Accept</a>
                                <a href="" style="color: green;" onclick="appointmentCancel('{{this._id}}')">Reject</a>
                            </td>


                            {{!-- <td><a href="/doctor/consult-form" style="color: rgb(79, 228, 79);">Consult</a>
                            </td>
                            <td> --}}


                        </tr>
                        {{/each}}
                    </tbody>
                </table>

            </div>
            <div class="tabcontent" id="MyPatients">
                <div class="row">

                    {{#each myPatients}}
                    <div class="col-md-4 ">
                        <div class="card border-info  mb-3 mt-4  " style="border-radius: 10px; width:max-content;">
                            <div class="card-header ">
                                <img class=" float-left rounded-circle  border card-image "
                                    style="height: 80px; width: 80px;" src="/user-images/{{this.user_id}}.jpg" alt="">
                                <h3 class="float-right mt-4 ml-1">{{this.userName}}</h3>
                            </div>
                            <div class="card-body ">

                                <p>Appointment Date : {{this.dateOfBooking}}</p>
                                <p>Appointment Time : {{this.timeOfBooking}}</p>
                                <p>Booking For : {{this.drName}}</p>
                                {{!-- <button type="button" class="  mt-3 mb-3 p-2"
                                    style="background-color:  #3efc8a; color: white;  border-radius: 30px; border: 1px;">Make
                                    an Appointment</button> --}}
                            </div>





                        </div>
                    </div>
                    {{/each}}
                </div>

            </div>
            <div class="tabcontent" id="Results">
                <div class="mb-3  row">

                    <button class="excel-export mr-4" style="color: green;" onclick="excelExport('{{doctor._id}}')">
                        Export to Excelsheet
                    </button>



                    {{!-- <button class="excel-export " style="color: green;" onclick="downloadExport()">
                        Download Excelsheet
                    </button> --}}



                </div>
                <div class="row">


                    {{#each prescriptions}}
                    <div class="col-md-3">
                        <div class="card border-info  mb-3 mt-4  " style="border-radius: 10px; width:max-content;">
                            <div class="card-header ">
                                <img class=" float-left rounded-circle  border card-image "
                                    style="height: 80px; width: 80px;" src="/user-images/{{this.userId}}.jpg" alt="">
                                <h3 class="float-right mt-4 ml-1">{{this.userName}}</h3>
                            </div>
                            <div class="card-body ">

                                <p>Prescription : </p>
                                {{!-- {{#each this.userPrescription}} --}}
                                <p>{{this.userPrescription}}</p>
                                {{!-- {{/each}} --}}

                                {{!-- <button type="button" class="  mt-3 mb-3 p-2"
                                    style="background-color:  #3efc8a; color: white;  border-radius: 30px; border: 1px;">Make
                                    an Appointment</button> --}}
                            </div>

                            <div class="card-footer">
                                <p class="float-right">Consulted</p>

                            </div>



                        </div>
                    </div>
                    {{/each}}
                </div>

            </div>
        </div>


    </div>
</section>
<script>
    window.onload = function () {
        startTab();
    };

    function startTab() {
        document.getElementById("defaultOpen").click();

    }

    function doctor(evt, evtName) {
        // Declare all variables
        var i, tabcontent, tablinks;

        // Get all elements with class="tabcontent" and hide them
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        // Get all elements with class="tablinks" and remove the class "active"
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        // Show the current tab, and add an "active" class to the button that opened the tab
        document.getElementById(evtName).style.display = "block";
        evt.currentTarget.className += " active";
    }
    function appointmentConfirm(appointmentId) {
        if (confirm('Are you sure you want to accept this?')) {
            $.ajax({
                url: '/doctor/confirm-appointment',
                data: {
                    appointment: appointmentId,

                },
                method: 'post',
                success: (response) => {

                    window.location.reload()
                }

            })
        }
    }
    function appointmentCancel(appointmentId) {
        if (confirm('Are you sure you want to reject this?')) {
            $.ajax({
                url: '/doctor/cancel-appointment',
                data: {
                    appointment: appointmentId,

                },
                method: 'post',
                success: (response) => {

                    window.location.reload()
                }

            })
        }
    }
    function excelExport(drId) {

        $.ajax({
            url: '/doctor/export-to-excel',
            data: {
                dr: drId,

            },

            method: 'post',
            success: (response) => {

                window.location.reload()
            }

        })

    }
    $(document).ready(function () {
        $('#search1').keyup(function () {
            search_table($(this).val());
        });
        function search_table(value) {
            $('#Appointments tr').each(function () {
                var found = 'false';
                $(this).each(function () {
                    if ($(this).text().toLowerCase().indexOf(value.toLowerCase()) >= 0) {
                        found = 'true';
                    }
                });
                if (found == 'true') {
                    $(this).show();
                }
                else {
                    $(this).hide();
                }
            });
        }
    });

    $(document).ready(function () {
        $('#search2').keyup(function () {
            search_table($(this).val());
        });
        function search_table(value) {
            $('#Bookings tr').each(function () {
                var found = 'false';
                $(this).each(function () {
                    if ($(this).text().toLowerCase().indexOf(value.toLowerCase()) >= 0) {
                        found = 'true';
                    }
                });
                if (found == 'true') {
                    $(this).show();
                }
                else {
                    $(this).hide();
                }
            });
        }
    });


</script>